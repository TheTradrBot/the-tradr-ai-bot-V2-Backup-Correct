Here‚Äôs a tighter Replit prompt you can just paste in üëá

‚∏ª

You are a senior quantitative developer and Python engineer working INSIDE this existing Replit project.

The repo is already imported. There is a file called strategy_spec_v3.md which is the official Blueprint HTF Confluence Strategy v3. Treat that file as the single source of truth for the trading logic and do any ‚Äúhomework‚Äù needed to understand it.

Your jobs, in order of priority:

‚∏ª

1. Use v3 as the architecture, create ONE strategy core
	‚Ä¢	Read strategy_spec_v3.md fully and respect its concepts:
	‚Ä¢	MN/W1/D1 for context, Daily as framework, 4H as execution.
	‚Ä¢	Daily OB + S/R + Fib golden pocket as entry zone.
	‚Ä¢	Daily structural ideas (H&S, inverse H&S, Bullish N, Bearish V) as patterns, not requirements.
	‚Ä¢	Fibs: retrace (0.618, 0.66, 0.796), extensions (‚àí0.25, ‚àí0.68, ‚àí1.00, ‚àí1.42, ‚àí2.00).
	‚Ä¢	Create or refactor to one core strategy engine, e.g. BlueprintStrategy in strategy_core.py:
	‚Ä¢	Input: OHLC data for MN/W1/D1/H4 + parameters.
	‚Ä¢	Output: clear signals with entry price, SL, TP levels, direction, and reasoning.
	‚Ä¢	Make sure:
	‚Ä¢	/scan, autoscan, /backtest and /output ALL use this same core engine.
	‚Ä¢	Remove or refactor any duplicate/old strategy logic so things cannot drift apart.

‚∏ª

2. Fix & harden the backtest so it matches the live strategy
	‚Ä¢	The backtester must call the same strategy logic as live, not a separate simplified version.
	‚Ä¢	Date ranges:
	‚Ä¢	/backtest asset period should accept strings like "Jan 2024 - Dec 2024" and "2024-01-01:2024-12-31".
	‚Ä¢	Parse them robustly and load only data inside that range.
	‚Ä¢	Execution model:
	‚Ä¢	Signals created on H4, entries executed in a realistic way (e.g. next H4 open or a clear consistent rule).
	‚Ä¢	SL/TP hit detection must be consistent: when a bar‚Äôs high/low crosses SL/TP, mark the exit with a clear rule.
	‚Ä¢	Stats:
	‚Ä¢	A trade = one position, even if it has multiple partial exits.
	‚Ä¢	Compute per trade:
	‚Ä¢	Net R, PnL %, entry/exit dates and prices, exit type.
	‚Ä¢	Global metrics:
	‚Ä¢	Total trades, win-rate (trades with net positive R / total trades), net return (R and %), max DD, average R/trade, exit breakdown (TP1, TP2, SL, BE, etc.).
	‚Ä¢	Fix any bugs that would give silly outputs (e.g. 17 winners, 14 losers but 6.5% win-rate).
	‚Ä¢	/output:
	‚Ä¢	Same backtest, but also returns a CSV (attachable) with one row per trade:
	‚Ä¢	trade_id, asset, direction, entry_date, entry_price, sl_price, tp1/tp2/‚Ä¶, exit_date, exit_price, exit_type, R_multiple, pnl_R, pnl_pct.

‚∏ª

3. Improve the strategy execution while staying loyal to v3

Your goal: better quality trades and realistic performance, without cheating.
	‚Ä¢	Keep the v3 structure and philosophy, but you may adjust the interpretation as parameters:
	‚Ä¢	Use a confluence score instead of ‚Äúall-or-nothing‚Äù filters (HTF bias, OB, S/R, fib, pattern, liquidity, H4 confirmation).
	‚Ä¢	Relax the 4H confirmation to several modes (e.g. 3-candle rule, 2-candle + structure, engulfing etc.) and treat it as a parameter.
	‚Ä¢	Use H4 swing lows/highs inside the Daily zone for SL (with a small buffer), instead of always the full Daily OB width.
	‚Ä¢	Make TP1 structural and at least 1R (prior swing or obvious level), and use fib extensions mainly for further TPs / runners.
	‚Ä¢	Fibs:
	‚Ä¢	Keep fib retracements/extensions, but treat them as helpers, not dictators.
	‚Ä¢	Always cross-check fib targets with structure and S/R.

‚∏ª

4. Data sanity (EURUSD, holidays) and realism
	‚Ä¢	If there is a reference CSV for EURUSD daily closes, use it to spot-check that backtest prices for EURUSD are reasonable (no huge deviations).
	‚Ä¢	Make sure the engine does not open new trades on FX holidays (or days with no real trading), but can still carry open positions.
	‚Ä¢	Use consistent OHLC feeds (timezones, broker session close) across D1/H4.

‚∏ª

5. Optimisation towards my goals (parameters only, no rule rewriting)

My aspirational goals per asset per year (not hard constraints, but targets):
	‚Ä¢	‚âà 60+ trades
	‚Ä¢	70‚Äì100% win-rate (aim higher, but stay realistic)
	‚Ä¢	+50% to +400% net return with sensible drawdown

To get closer to this:
	‚Ä¢	Build a simple parameter optimisation tool around the core strategy:
	‚Ä¢	Tunable parameters: confluence threshold, H4 confirmation mode, fib zone tolerance, SL buffer, TP schema, filters (Friday, choppy regime, etc.), risk per trade in a small range.
	‚Ä¢	Use multi-year data per asset to search for good parameter sets.
	‚Ä¢	Never rewrite core rules or violate the v3 spec; just tune the knobs.
	‚Ä¢	The backtest must be brutally realistic (no lookahead, no fantasy fills). If a parameter set looks amazing but is obviously overfit, prefer safer ones.

‚∏ª

6. Discord UX, logging, and robustness
	‚Ä¢	/scan asset: short, clean embed:
	‚Ä¢	Bias (Bullish/Bearish/Neutral), confluence score, quick summary, key levels, ‚Äúsetup: active / waiting / scan only‚Äù.
	‚Ä¢	Autoscan:
	‚Ä¢	Periodically scan key assets, only post the best setups.
	‚Ä¢	/backtest and /output must be stable:
	‚Ä¢	Good error handling (no unhandled exceptions in Discord), clear error messages, proper logging.
	‚Ä¢	Add caching where useful (data and repeated backtests) to keep things responsive.

Finally, make sure the bot runs via the Replit run command (e.g. python main.py) without errors, and that the strategy, backtest, and outputs are all aligned with strategy_spec_v3.md and tuned to move towards the goals above.